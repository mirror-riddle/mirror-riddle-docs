---
id: module
title: 模块
---

### 模块的特性

- 模块内代码总是处于严格模式下，无法变成非严格模式。
- 模块顶层的 this 值是 undefined。
- 模块顶层创建的变量不会自动添加到全局作用域中去。
- 模块可以通过 export 导出变量、函数等，让它们可以在模块外部使用。
- 模块可以通过 import 导入其他模块导出的变量、函数等。

模块比之前的 JS 脚本强大的地方，在于模块允许只导入导出需要的 bindings，而不是暴露模块内所有的东西。

### 导入导出

- 导入的 bindings 就像用 const 声明的常量一样，不能对其赋值，不能重新声明，不能在声明之前使用。
- 不管导入一个模块多少次，该模块只会执行一次，之后就会保存在内存中以待重用。
- 导入导出不能发生在函数或者其他语句内，它们只能在模块顶层进行。原因之一是 JS 引擎可以静态检查哪些 bindings 需要导入导出。

### 在浏览器里使用模块

- 默认 script 标签加载的是 JS 脚本而不是模块，script 的 type 属性未设置或者设置为 text/javascript。要想加载模块，需要将 type 属性设置为 module。
- 如果浏览器不兼容模块，那么它会忽略掉 type 为 module 的 script 标签。
- 模块类型的 script 总是表现得 defer 属性为 true 一样，浏览器解析到模块类型的 script 标签时，会立即下载对应的模块文件，但是要在 HTML 文档解析完毕后(DOMContentLoaded)才会开始执行模块文件。模块文件的执行顺序和它们在 HTML 里出现的顺序一样。这对行内模块也适用。
- async 属性为 true 的 script 标签会在下载、解析完成之后立即执行，并且不受它们在 HTML 文档里出现的顺序影响。当设置模块类型的 script 标签 async 属性为 true 时，模块下载完成后，在模块导入的其他模块们下载完成之前，模块不会执行
